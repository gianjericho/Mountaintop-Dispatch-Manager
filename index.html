<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispatch Manager</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-100 pb-24 transition-colors duration-300">

    <div id="login-screen" class="fixed inset-0 z-50 bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-8 shadow-2xl fade-in">
            <div class="text-center mb-8">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-layer-group text-3xl text-blue-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Dispatch Manager</h1>
            </div>
            <div class="space-y-4">
                <input type="text" id="login-user" placeholder="Username" class="w-full border border-gray-300 rounded-lg p-3 outline-none focus:ring-2 focus:ring-blue-500">
                <input type="password" id="login-pass" placeholder="Password" class="w-full border border-gray-300 rounded-lg p-3 outline-none focus:ring-2 focus:ring-blue-500">
                <button id="btn-login" onclick="attemptLogin()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition shadow-lg mt-2">Login</button>
                <p id="login-error" class="text-red-500 text-xs text-center hidden"><i class="fa-solid fa-circle-exclamation mr-1"></i> Invalid Credentials</p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="bg-white shadow-sm sticky top-0 z-40 dark-element transition-colors duration-300">
            <div class="max-w-lg mx-auto px-4 py-3">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-2 bg-slate-100 dark-bg-sub p-1 rounded-lg transition-colors">
                        <button onclick="switchAppMode('SLR')" id="mode-slr" class="px-4 py-1 rounded-md text-xs font-bold transition">SLR</button>
                        <button onclick="switchAppMode('SLI')" id="mode-sli" class="px-4 py-1 rounded-md text-xs font-bold transition text-gray-400">SLI</button>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleTheme()" class="text-gray-400 hover:text-purple-500 p-1"><i class="fa-solid fa-moon text-lg"></i></button>
                        <button onclick="logout()" class="text-gray-400 hover:text-red-500 p-1"><i class="fa-solid fa-right-from-bracket text-lg"></i></button>
                        <button onclick="toggleSettings()" class="text-gray-400 hover:text-blue-600 p-1"><i class="fa-solid fa-gear text-lg"></i></button>
                    </div>
                </div>
                
                <div class="flex justify-between items-center">
                    <h1 class="text-lg font-extrabold text-slate-800 tracking-tight dark-text" id="app-title">SLR Dispatch</h1>
                    <div class="flex gap-2">
                        <button onclick="openBulkModal()" id="btn-bulk" class="bg-purple-100 text-purple-600 px-3 py-1 rounded-lg text-sm font-bold hover:bg-purple-200 transition border border-purple-200"><i class="fa-solid fa-list-check mr-1"></i> Bulk</button>
                        <button onclick="openModal()" id="btn-new" class="bg-green-600 text-white px-3 py-1 rounded-lg text-sm font-bold hover:bg-green-700 shadow-lg shadow-green-30 transition">+ New</button>
                    </div>
                </div>
            </div>
            
            <div class="max-w-lg mx-auto px-4 flex mt-1 border-b border-gray-200 dark-border bg-white dark-element">
                <button onclick="switchTab('active')" id="nav-active" class="flex-1 py-3 text-center text-sm nav-active">Dispatch</button>
                <button onclick="switchTab('history')" id="nav-history" class="flex-1 py-3 text-center text-sm nav-item">History</button>
                <button onclick="switchTab('performance')" id="nav-performance" class="flex-1 py-3 text-center text-sm nav-item">Performance</button>
            </div>
        </div>

        <div class="max-w-lg mx-auto p-4">
            <div class="bg-white p-3 rounded-xl shadow-sm border border-gray-200 mb-4 space-y-3 dark-element dark-border">
                <div class="flex justify-between items-center">
                     <div class="flex items-center text-gray-500"><i class="fa-solid fa-magnifying-glass mr-2" id="filter-icon"></i><span class="text-xs font-bold uppercase tracking-wider">Search & Filter</span></div>
                     <button onclick="clearAllFilters()" id="clear-filters-btn" class="hidden text-[10px] bg-red-100 hover:bg-red-200 text-red-600 px-3 py-1 rounded-full font-bold transition">RESET ALL</button>
                </div>
                
                <input type="text" id="global-search" onkeyup="render(true)" placeholder="Search Name..." class="w-full text-sm font-bold text-gray-700 bg-gray-50 border border-gray-200 rounded-lg p-2.5 outline-none focus:ring-2 focus:ring-blue-100 dark-input">

                <div class="grid grid-cols-3 gap-2">
                    <input type="date" id="global-date-filter" onchange="render(true)" class="w-full text-xs font-bold text-gray-700 bg-gray-50 border border-gray-200 rounded-lg p-2 outline-none dark-input">
                    <select id="global-team-filter" onchange="render(true)" class="w-full text-xs font-bold text-gray-700 bg-gray-50 border border-gray-200 rounded-lg p-2 outline-none dark-input">
                        <option value="">All Teams</option>
                    </select>
                    <select id="global-area-filter" onchange="render(true)" class="w-full text-xs font-bold text-gray-700 bg-gray-50 border border-gray-200 rounded-lg p-2 outline-none dark-input">
                        <option value="">All Areas</option>
                    </select>
                </div>
            </div>

            <div id="loading-screen" class="text-center py-10"><i class="fa-solid fa-circle-notch fa-spin text-4xl text-gray-400"></i><p class="text-sm text-gray-500 mt-2">Loading...</p></div>

            <div id="view-performance" class="hidden fade-in space-y-6">
                <div class="flex justify-between items-center" id="perf-preset-container">
                    <h3 class="text-xs font-bold text-gray-400 uppercase">Dashboard</h3>
                    <select id="perf-filter" onchange="render(true)" class="bg-white border border-gray-300 text-gray-700 text-xs font-bold py-1 px-3 rounded-lg outline-none shadow-sm dark-input">
                        <option value="all">All Time</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option>
                    </select>
                </div>
                <div id="perf-card" class="bg-slate-800 text-white rounded-2xl p-5 shadow-xl relative overflow-hidden transition-colors duration-500">
                    <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white rounded-full opacity-10 blur-xl"></div>
                    <div class="flex justify-between items-end mb-2"><div><p class="text-white/60 text-xs font-bold uppercase tracking-wider">Efficiency Score</p><h2 class="text-3xl font-bold" id="global-percent">0%</h2></div><div class="text-right"><p class="text-sm text-white/80"><span id="global-done" class="text-white font-bold">0</span> of <span id="global-total">0</span></p></div></div>
                    <div class="w-full bg-black/30 rounded-full h-2.5"><div id="global-bar" class="bg-white h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                </div>
                <div id="team-stats-container" class="grid grid-cols-2 gap-3"></div>
                <div id="area-stats-container" class="space-y-3"></div>
            </div>

            <div id="view-list" class="hidden fade-in">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="list-header" class="text-sm font-bold text-gray-500 uppercase">Active Dispatches</h2>
                    <span id="list-count" class="bg-gray-200 text-gray-600 text-xs font-bold px-2 py-1 rounded-full">0</span>
                </div>
                <div id="card-container" class="space-y-2"></div>
                <button id="show-more-btn" onclick="showMore()" class="hidden w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-500 font-bold rounded-xl mt-4 text-sm transition">Show More Logs</button>
                <div id="empty-msg" class="hidden text-center py-16 text-gray-400"><p class="text-sm">No records found.</p></div>
            </div>
        </div>
    </div>

    <div id="form-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm dark-element">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-gray-800 dark-text" id="modal-title">New Dispatch</h2><button onclick="toggleModal('form-modal')" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button></div>
            <div class="space-y-3">
                <input type="hidden" id="edit-id"> 
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Subscriber Name</label><input type="text" id="input-name" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 outline-none transition dark-input"></div>
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Area / Location</label><select id="input-area" class="w-full border border-gray-300 rounded-lg p-2.5 bg-white outline-none dark-input"></select></div>
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Assign Team</label><select id="input-team" class="w-full border border-gray-300 rounded-lg p-2.5 bg-white outline-none dark-input"></select></div>
                <button onclick="saveSO()" id="modal-btn" class="w-full text-white py-3 rounded-xl font-bold shadow-lg transition mt-2">Confirm</button>
            </div>
        </div>
    </div>
    
    <div id="bulk-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm dark-element">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-gray-800 dark-text"><i class="fa-solid fa-list-check text-gray-500 mr-2"></i>Bulk Dispatch</h2><button onclick="toggleModal('bulk-modal')" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button></div>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2"><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Area</label><select id="bulk-area" class="w-full border border-gray-300 rounded-lg p-2 text-sm bg-white outline-none dark-input"></select></div><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Team</label><select id="bulk-team" class="w-full border border-gray-300 rounded-lg p-2 text-sm bg-white outline-none dark-input"></select></div></div>
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Paste Names</label><textarea id="bulk-names" rows="6" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 outline-none dark-input"></textarea></div>
                <button onclick="saveBulkSO()" id="bulk-btn" class="w-full text-white py-3 rounded-xl font-bold shadow-lg transition mt-2">Dispatch All</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm dark-element">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark-text">Manage Teams</h2>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="flex gap-2 mb-4">
                <input type="text" id="new-team-name" placeholder="Add New Team..." class="flex-1 border border-gray-300 rounded-lg p-2 text-xs outline-none dark-input">
                <button onclick="addNewTeam()" id="btn-add-team" class="text-white px-3 py-2 rounded-lg font-bold text-xs transition"><i class="fa-solid fa-plus"></i> Add</button>
            </div>
            <p class="text-xs text-gray-400 mb-2 italic">Renaming updates history.</p>
            <div id="team-list-settings" class="space-y-2 max-h-60 overflow-y-auto pr-2"></div>
        </div>
    </div>

    <div id="team-analytics-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[80vh] dark-element"><div id="team-modal-header" class="p-6 text-white shrink-0"><div class="flex justify-between items-start"><div><p class="text-xs font-bold text-white/70 uppercase">Team Performance</p><h2 class="text-2xl font-bold" id="team-modal-name"></h2></div><button onclick="toggleModal('team-analytics-modal')" class="text-white/50 hover:text-white"><i class="fa-solid fa-times text-xl"></i></button></div><div class="mt-4 flex items-end gap-2"><span class="text-4xl font-bold" id="team-modal-percent"></span><span class="text-sm text-white/70 mb-1">Efficiency</span></div></div><div class="p-4 overflow-y-auto"><div class="grid grid-cols-2 gap-3 mb-4"><div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-center dark-bg-sub dark-border"><p class="text-xs text-blue-500 font-bold uppercase">Total</p><p class="text-xl font-bold text-blue-700" id="team-modal-total"></p></div><div class="bg-green-50 p-3 rounded-xl border border-green-100 text-center dark-bg-sub dark-border"><p class="text-xs text-green-500 font-bold uppercase">Done</p><p class="text-xl font-bold text-green-700" id="team-modal-done"></p></div></div><h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Top Areas</h4><div id="team-modal-areas" class="space-y-1 mb-4"></div><h4 class="text-xs font-bold text-gray-400 uppercase mb-2">History</h4><div id="team-modal-history" class="space-y-2 text-sm text-gray-600"></div></div></div></div>

    <script src="app.js"></script>
</body>
</html>